<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Request Purchase</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#fff;
  --text:#111;
  --muted:#666;
  --line:#e5e5e5;
  --accent:#000;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  line-height:1.6;
}

.container{
  max-width:800px;
  margin:0 auto;
  padding:40px 20px;
}

.back{
  font-size:14px;
  color:var(--muted);
  display:inline-block;
  margin-bottom:30px;
}

h1{font-size:28px;margin-bottom:20px}
p{margin-bottom:16px;font-size:16px}

.product-summary{
  border:1px solid var(--line);
  padding:20px;
  margin:20px 0;
  display:flex;
  gap:20px;
}

.product-summary img{
  width:120px;
  height:120px;
  object-fit:contain;
  border:1px solid var(--line);
}

.product-details span{
  display:block;
  margin-bottom:6px;
}

.email-block{
  width:100%;
  min-height:260px;
  padding:15px;
  border:1px solid var(--line);
  background:#f9f9f9;
  font-family:monospace;
  white-space:pre;
  resize:vertical;
  margin-bottom:15px;
}

.actions{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:30px;
}

.button{
  padding:12px 22px;
  border:1px solid var(--accent);
  background:#fff;
  cursor:pointer;
  text-transform:uppercase;
  font-size:13px;
  letter-spacing:.05em;
}

.button:hover{
  background:#000;
  color:#fff;
}

.note{
  font-size:14px;
  color:var(--muted);
  margin-top:10px;
}

.contacts{
  border-top:1px solid var(--line);
  padding-top:20px;
  font-size:15px;
}
</style>
</head>

<body>
<div class="container">

<a href="index.html" class="back">← Back to collection</a>

<h1>Request Purchase</h1>

<p>Please copy the email text below and send it to the seller.</p>

<!-- PRODUCT -->
<div class="product-summary">
  <img id="productImage" src="">
  <div class="product-details">
    <span><strong>Name:</strong> <span id="prodName"></span></span>
    <span><strong>Description:</strong> <span id="prodDescription"></span></span>
    <span><strong>Materials:</strong> <span id="prodMaterials"></span></span>
    <span><strong>Specifications:</strong> <span id="prodSpecs"></span></span>
  </div>
</div>

<!-- EMAIL TEXT -->
<textarea id="emailBlock" class="email-block" readonly></textarea>

<div class="actions">
  <button class="button" id="copyBtn" type="button">Copy email text</button>
  <a class="button" id="openMailBtn"
     href="mailto:donbriz.lighting@gmail.com?subject=Purchase%20Request">
     Open email app
  </a>
</div>

<p class="note" id="iosNote" style="display:none">
On iPhone or iPad: please paste the copied text into the email body.
</p>

<div class="contacts">
<strong>Contact:</strong><br>
donbriz.lighting@gmail.com
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  if(isIOS){
    document.getElementById("openMailBtn").style.display="none";
    document.getElementById("iosNote").style.display="block";
  }

  const id = new URLSearchParams(location.search).get("id");
  if(!id) location.href="index.html";

  const csv = await (await fetch("products.csv")).text();
  const lines = csv.trim().split("\n");
  const headers = lines.shift().split(";");

  const products = lines.map(l=>{
    const v=l.split(";");
    let o={};
    headers.forEach((h,i)=>o[h]=v[i]);
    return o;
  });

  const p = products.find(x=>x.id===id);
  if(!p) return;

  const name = `${p.title_en} - ${p.name || ""}`;

  document.getElementById("prodName").textContent = name;
  document.getElementById("prodDescription").textContent = p.description_en;
  document.getElementById("prodMaterials").textContent = p.materials?.replace(/\\n/g,", ");
  document.getElementById("prodSpecs").textContent =
    `Diameter: ${p.diameter} cm, Height: ${p.height} cm, Weight: ${p.weight} kg, Lamps: ${p.lamps}`;
  document.getElementById("productImage").src = `images/product${id}-1.png`;

  const emailText =
`To: donbriz.lighting@gmail.com
Subject: Purchase Request

Hello,

I would like to place an order for the following light fixture:

Name: ${name}
Description: ${p.description_en}
Materials: ${p.materials?.replace(/\\n/g,", ")}
Specifications: Diameter: ${p.diameter} cm, Height: ${p.height} cm, Weight: ${p.weight} kg, Lamps: ${p.lamps}

Delivery Address:
[Your full delivery address]

Additional Notes:
[Any questions]

Thank you!`;

  document.getElementById("emailBlock").value = emailText;

  document.getElementById("copyBtn").onclick = async ()=>{
    await navigator.clipboard.writeText(emailText);
    document.getElementById("copyBtn").textContent="Copied ✓";
    setTimeout(()=>document.getElementById("copyBtn").textContent="Copy email text",2000);
  };

});
</script>

</body>
</html>
